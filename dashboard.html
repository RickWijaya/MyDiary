<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Dashboard - Daily Emotion Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.roboflow.com/0.2.26/roboflow.js"></script>
  <link rel="stylesheet" href="assets/css/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    #webcam,
    #capturePreview {
      transform: scaleX(-1);
    }
  </style>
</head>

<body class="min-h-screen bg-white">
  <!-- Top bar -->
  <header class="bg-black text-white shadow-lg">
    <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center gap-2">
        <span
          class="inline-flex h-8 w-8 rounded-xl bg-orange-500 text-black items-center justify-center font-black text-lg">
          ET
        </span>
        <div class="hidden sm:block">
          <h1 class="text-lg md:text-xl font-bold leading-tight">
            Daily Emotion Tracker
          </h1>
          <p class="text-xs text-white/70">
            Face check-in â€¢ Voice diary â€¢ Mood analytics
          </p>
        </div>
      </div>
        <a href="recap.html" class="nav-link-recap text-orange-500 hover:text-orange-900">
          Recap
        </a>
      <div class="flex items-center gap-4 text-xs md:text-sm">
        <!-- Clock (WIB) -->
        <div class="text-right hidden sm:block">
          <p class="text-white/60">WIB time</p>
          <p class="font-mono text-xs md:text-sm text-orange-300" id="clock">
            --
          </p>
        </div>

        <!-- User email -->
        <div class="text-right">
          <p class="text-white/60">Logged in as</p>
          <p class="font-semibold text-orange-400" id="userEmail"></p>
        </div>

        <!-- Logout -->
        <form method="POST" action="backend/logout.php">
          <button
            class="px-3 py-1.5 rounded-xl bg-orange-500 text-black font-semibold hover:bg-orange-600 text-xs md:text-sm active:translate-y-[1px]">
            Logout
          </button>
        </form>
      </div>
    </div>
  </header>


  <main class="max-w-6xl mx-auto px-4 py-6 space-y-6">
    <!-- Summary row: streak + recap -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Streak card -->
      <div class="bg-white rounded-2xl shadow border border-black/5 p-4 flex flex-col justify-between">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-sm font-semibold tracking-wide text-black/80">
            Daily streak
          </h2>
          <span class="px-2 py-0.5 text-[10px] uppercase tracking-[0.2em] bg-black text-orange-400 rounded-full">
            STREAK
          </span>
        </div>
        <div class="flex items-end gap-2 mb-1">
          <span id="streakValue" class="text-4xl font-bold">0</span>

          <p class="text-xs text-black/60 mb-[6px]">days</p>
        </div>
        <p class="text-xs text-black/60">
          Keep checking in every day to build your emotional awareness habit.
        </p>
      </div>

      <!-- Recap card -->
      <div class="md:col-span-2 bg-white rounded-2xl shadow border border-black/5 p-4 flex flex-col">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-sm font-semibold tracking-wide text-black/80">
            Recap insights
          </h2>
          <span
            class="px-2 py-0.5 text-[10px] uppercase tracking-[0.2em] bg-orange-500/10 text-orange-500 border border-orange-500/40 rounded-full">
            LAST 7 DAYS
          </span>
        </div>
        <ul id="recapList" class="text-xs md:text-sm text-black/70 list-disc ml-4 space-y-1"></ul>
      </div>
    </section>

    <!-- Chart row -->
    <section class="bg-white rounded-2xl shadow border border-black/5 p-4">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-sm font-semibold tracking-wide text-black/80">
          Emotion trend
        </h2>
        <span class="text-[10px] uppercase tracking-[0.2em] text-black/50">
          LINE GRAPH
        </span>
      </div>
      <div class="mb-4 flex flex-wrap gap-2">
        <button class="emotion-toggle-btn px-3 py-1 rounded-full border text-sm font-medium bg-orange-500 text-white"
          data-emotion="all">
          All
        </button>
        <button class="emotion-toggle-btn px-3 py-1 rounded-full border text-sm font-medium" data-emotion="happy">
          Happy
        </button>
        <button class="emotion-toggle-btn px-3 py-1 rounded-full border text-sm font-medium" data-emotion="sad">
          Sad
        </button>
        <button class="emotion-toggle-btn px-3 py-1 rounded-full border text-sm font-medium" data-emotion="angry">
          Angry
        </button>
      </div>
      <!-- When insufficient data -->
      <div id="noDataBox" class="hidden bg-white p-4 rounded-lg shadow border border-gray-200">
        <h2 class="text-lg font-semibold mb-2">Insufficient Data</h2>
        <p class="text-gray-600 mb-3">
          You need at least 2 check-ins to unlock emotion trend insights.
        </p>

        <div class="mt-3 p-3 bg-gray-50 rounded-md border">
          <p><strong>Date:</strong> <span id="noDataDate">-</span></p>
          <p><strong>Emotion:</strong> <span id="noDataEmotion">-</span></p>
          <p><strong>Diary:</strong></p>
          <p class="text-gray-700 whitespace-pre-line" id="noDataDiary">-</p>
        </div>
      </div>

      <!-- Actual chart container -->
      <div id="chartContainer">
        <canvas id="emotionChart"></canvas>
      </div>

      <p class="mt-2 text-[11px] text-black/50">
        Each line shows whether an emotion was present on that day (1 = present, 0 = not present).
      </p>
    </section>

    <!-- Check-in panel -->
    <section class="bg-white rounded-2xl shadow border border-black/5 p-4">
      <div class="flex items-center justify-between mb-2">
        <div>
          <h2 class="text-sm font-semibold tracking-wide text-black/80">
            Today's check-in
          </h2>
          <p class="text-[11px] text-black/60">
            Start a new check-in for today in WIB (Asia/Jakarta) time.
          </p>
        </div>
        <span class="px-2 py-0.5 text-[10px] uppercase tracking-[0.2em] bg-orange-500 text-black rounded-full">
          TODAY
        </span>
      </div>

      <!-- Already checked in info -->
      <div id="alreadyCheckedIn" class="hidden border border-orange-500/30 bg-orange-50 rounded-2xl p-3 mb-3">
        <p class="text-xs md:text-sm text-black/80 mb-1 font-semibold">
          You already checked in today ðŸŽ¯
        </p>
        <p class="text-xs md:text-sm text-black/80">
          <span class="font-semibold">Final emotion:</span>
          <span id="todayFinalEmotion" class="text-orange-600"></span>
        </p>
        <p class="text-xs md:text-sm text-black/80 mt-1">
          <span class="font-semibold">Diary (auto from voice):</span>
          <span id="todayDiary"></span>
        </p>
        <div class="mt-2 pt-2 border-t border-orange-500/20">
          <p class="text-xs md:text-sm text-black/80">
            <span class="font-semibold">Recommendation:</span>
            <span id="todayRecommendation" class="italic text-black/70"></span>
          </p>
        </div>

        <!-- Multimedia Recommendations -->
        <div id="recMediaContainer" class="hidden mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- YouTube -->
          <div class="aspect-video rounded-xl overflow-hidden shadow-sm border border-black/10">
            <iframe id="recYoutube" class="w-full h-full" src="" title="YouTube video player" frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen></iframe>
          </div>
          <!-- Spotify -->
          <div class="h-80 md:h-auto rounded-xl overflow-hidden shadow-sm border border-black/10">
            <iframe id="recSpotify" class="w-full h-full" src="" title="Spotify embed" frameborder="0"
              allowtransparency="true" allow="encrypted-media"></iframe>
          </div>
        </div>
      </div>

      <!-- If not checked in: show button -->
      <div id="checkinCallToAction" class="flex items-center justify-between mt-2">
        <p class="text-xs md:text-sm text-black/70" id="checkinStatus">
          You haven't checked in yet today.
        </p>
        <button id="checkInOpenBtn"
          class="ml-3 bg-black text-white px-4 py-2 rounded-xl text-xs md:text-sm font-semibold hover:bg-black/90 active:translate-y-[1px]">
          Check in today
        </button>
      </div>
    </section>
  </main>

  <!-- Check-in popup modal -->
  <div id="checkinModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-40 hidden">
    <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full mx-4 p-4 md:p-6 border border-black/5">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-bold text-black">Today's Check-in</h3>
        <button id="closeCheckinModalBtn" class="text-xs text-black/60 hover:text-black">
          âœ• Close
        </button>
      </div>
      <div>
  <h4 class="text-xs font-semibold mb-2 text-black/80">Face check</h4>

  <!-- Webcam + Face Template Overlay -->
  <div class="relative aspect-video bg-black rounded-2xl overflow-hidden mb-2 border border-black/40">
    <!-- Live webcam -->
    <video
      id="webcam"
      autoplay
      playsinline
      class="w-full h-full object-cover">
    </video>

    <!-- Face template overlay -->
    <div class="pointer-events-none absolute inset-0 flex items-center justify-center">
      <!-- Outer dark overlay (optional vignette) -->
      <div class="absolute inset-0 bg-black/30"></div>

      <!-- Face guide circle -->
      <div class="relative flex items-center justify-center">
        <div
          class="w-40 h-40 md:w-56 md:h-56 rounded-full border-2 border-orange-400 shadow-[0_0_25px_rgba(249,115,22,0.7)]">
        </div>

        <!-- Small top text -->
        <div class="absolute -top-8 w-full text-center">
          <p class="text-[11px] md:text-xs font-medium text-white drop-shadow">
            Align your face inside the circle
          </p>
        </div>
      </div>
    </div>
  </div>

  <button id="captureBtn"
    class="w-full bg-black text-white py-2 rounded-xl text-xs md:text-sm font-semibold hover:bg-black/90 active:translate-y-[1px]">
    Capture face
  </button>
  <p class="text-[11px] text-black/50 mt-1">
    We capture a single frame and send it to the AI for emotion detection.
  </p>
  <img
    id="capturePreview"
    class="mt-2 rounded-xl hidden border border-black/10"
    alt="Captured frame preview" />
</div>


        <!-- Voice diary -->
        <div>
          <h4 class="text-xs font-semibold mb-2 text-black/80">Voice diary</h4>

          <!-- Audio controls -->
          <div class="border border-black/10 rounded-2xl p-3 mb-3">
            <div class="flex items-center justify-between mb-2">
              <button id="recordBtn"
                class="flex items-center gap-2 bg-orange-500 text-black px-3 py-1.5 rounded-xl text-xs md:text-sm font-semibold hover:bg-orange-600 active:translate-y-[1px]">
                ðŸŽ™ Start recording
              </button>
              <audio id="audioPlayback" controls class="hidden w-40 md:w-48"></audio>
            </div>
            <p id="recordStatus" class="text-[11px] text-black/60 mb-1">
              Tap the mic to record your voice diary.
            </p>
            <canvas id="audioWaveCanvas" class="w-full h-16 bg-black/5 rounded-xl border border-black/5"></canvas>
          </div>

          <!-- Transcript display (read-only) -->
          <h5 class="text-[11px] font-semibold mb-1 text-black/70">Transcript (auto from voice)</h5>
          <label for="transcriptDisplay" class="block text-sm font-medium text-gray-700 mb-1">
            Diary
          </label>
          <textarea id="transcriptDisplay"
            class="w-full border border-gray-300 rounded-lg p-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 min-h-[100px]"
            placeholder="Your transcript will appear here after recording. You can edit it before submitting."></textarea>


          <button id="submitCheckinBtn"
            class="mt-3 w-full bg-orange-500 text-black py-2 rounded-xl text-xs md:text-sm font-semibold hover:bg-orange-600 disabled:opacity-60 active:translate-y-[1px]">
            Submit today's check-in
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Emotion confirmation modal -->
  <div id="emotionModal" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 border border-black/5">
      <h3 class="text-lg font-bold mb-2 text-black">
        Confirm your emotion
      </h3>
      <p class="text-sm text-black/80 mb-4">
        We think your emotion today is
        <span id="modalEmotionLabel" class="font-semibold text-orange-600"></span>.
        Is this correct?
      </p>
      <div class="flex justify-end gap-2">
        <button id="emotionNoBtn"
          class="px-3 py-1.5 rounded-xl border border-black/10 text-sm text-black hover:bg-black/5">
          No, thatâ€™s not right
        </button>
        <button id="emotionYesBtn"
          class="px-3 py-1.5 rounded-xl bg-orange-500 text-black text-sm font-semibold hover:bg-orange-600">
          Yes, thatâ€™s correct
        </button>
      </div>
    </div>
  </div>

  <script src="assets/js/dashboard.js"></script>
</body>

</html>